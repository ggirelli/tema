#!/usr/bin/env Rscript

options(echo=TRUE)
args <- commandArgs(trailingOnly = TRUE)

# Check parameters
if(length(args) != 5) stop('./addAttributeToNetwork.R session_id graph_name attr_type attr_name attr_new_name')

# Load requirements
library(igraph)
library(rjson)

# Start
if(file.exists(paste0('../session/', args[1], '/'))) {
	setwd(paste0('../session/', args[1], '/'))

	cat('> Read JSON file\n')
	s <- read.delim(paste0(args[2], '.json'), header = F, as.is=T, quote = "")[1,1]
	l <- fromJSON(s)

	attr.tables <- nm$graph.list.to.attr.tables(l)
	v.attr.table <- attr.tables$nodes
	e.attr.table <- attr.tables$edges

	cat('> Rename attribute\n')
	if ( 'edges' == args[3] ) {
		eval(parse(text=paste0('E(g)$', args[5], ' <- E(g)$', args[4])))
		g <- remove.edge.attribute(g, args[4])
	} else if ( 'nodes' == args[3] ) {
		eval(parse(text=paste0('V(g)$', args[5], ' <- V(g)$', args[4])))
		g <- remove.vertex.attribute(g, args[4])
	}

	cat('> Convert back to JSON\n')
	source('../../Rscripts/extendIgraph.R')
	write.graph(g, paste0(args[2], '.json'), format='json')
}